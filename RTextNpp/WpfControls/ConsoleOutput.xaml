<UserControl x:Class="RTextNppPlugin.WpfControls.ConsoleOutput"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:viewModels="clr-namespace:RTextNppPlugin.ViewModels"
             xmlns:wpfControls="clr-namespace:RTextNppPlugin.WpfControls"                        
             xmlns:uc="clr-namespace:LedControl;assembly=LedControl"
             mc:Ignorable="d" 
             d:DesignHeight="300" d:DesignWidth="300">
    <UserControl.DataContext>
        <viewModels:ConsoleViewModel/>
    </UserControl.DataContext>       
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <Storyboard x:Key="OnControlLoaded">
            <ObjectAnimationUsingKeyFrames BeginTime="00:00:00" Storyboard.TargetProperty="(UIElement.Visibility)">
                <DiscreteObjectKeyFrame KeyTime="00:00:00" Value="{x:Static Visibility.Visible}"/>
                <DiscreteObjectKeyFrame KeyTime="00:00:00.8000000" Value="{x:Static Visibility.Collapsed}"/>
                <DiscreteObjectKeyFrame KeyTime="00:00:01.4000000" Value="{x:Static Visibility.Visible}"/>
            </ObjectAnimationUsingKeyFrames>
        </Storyboard>
    </UserControl.Resources>
    <Grid>
        <DockPanel HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                   IsHitTestVisible="True"
                   Background="Transparent">
            <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" HorizontalAlignment="Stretch"
                        IsHitTestVisible="True"
                        Background="Transparent">
                <Label>Output channel : </Label>
                <ComboBox Name="WorkspaceSelector" 
                          HorizontalAlignment="Stretch" 
                          MinWidth="100"
                          IsReadOnly="True"
                          SelectedValue="Workspace"
                          SelectedIndex="{Binding Index, Mode=TwoWay }"
                          ItemsSource="{Binding WorkspaceCollection}"
                          DisplayMemberPath="Workspace"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" DockPanel.Dock="Bottom" Visibility="{Binding IsAutomateWorkspace, Converter={StaticResource ResourceKey=BooleanToVisibilityConverter}}">
                <Label>Backend Status : </Label>
                <uc:Led Height="17" FlashingPeriod="300" IsActive="{x:Null}" ColorOn="Green" ColorOff="Yellow"/>
                <Label/>
            </StackPanel>
            <Grid HorizontalAlignment="Stretch" VerticalAlignment="Stretch" DockPanel.Dock="Top" x:Name="WorkspaceGrid" SizeChanged="OnWorkspaceGridSizeChanged">
                <TabControl IsHitTestVisible="True" 
                            Name="OutputTabControl"
                            Background="Transparent">
                    <TabItem Name="Console" IsHitTestVisible="True" Background="Transparent">
                        <TabItem.Header>
                            <Label IsHitTestVisible="True" PreviewMouseDown="ConsolePreviewMouseDown">Console</Label>
                        </TabItem.Header>
                        <RichTextBox VerticalScrollBarVisibility="Auto"
                     HorizontalScrollBarVisibility="Visible"
                     HorizontalAlignment="Stretch"
                     VerticalAlignment="Stretch"
                     IsUndoEnabled="False"                     
                     AllowDrop="False"                     
                     Background="Black"                                 
                     Name="ConsoleViewRichTextBox"                  
                     IsReadOnly="True">
                            <wpfControls:ConsoleFlowDocument Channel="{Binding Workspace}"/>
                        </RichTextBox>
                    </TabItem>
                    <TabItem Name="ErrorList"
                             IsHitTestVisible="True"
                             Background="Transparent"
                             Visibility="{Binding IsAutomateWorkspace, Converter={StaticResource ResourceKey=BooleanToVisibilityConverter}}">
                        <TabItem.Triggers>
                            <EventTrigger RoutedEvent="FrameworkElement.Loaded">
                                <BeginStoryboard Storyboard="{StaticResource OnControlLoaded}"/>
                            </EventTrigger>
                        </TabItem.Triggers>
                        <TabItem.Header>
                            <Label IsHitTestVisible="True" PreviewMouseDown="ErrorListPreviewMouseDown">Errors</Label>
                        </TabItem.Header>
                    </TabItem>
                </TabControl>
                <Grid HorizontalAlignment="Center" VerticalAlignment="Center" IsHitTestVisible="False" Visibility="{Binding IsBusy, Converter={StaticResource ResourceKey=BooleanToVisibilityConverter}}">
                    <wpfControls:CircularProgressBar HorizontalAlignment="Center" 
                                                     VerticalAlignment="Center" 
                                                     SegmentColor="#FF878889"
                                                     StrokeThickness="25"
                                                     x:Name="OuterProgressBar"
                                                     Percentage="100"/>
                    <Label HorizontalAlignment="Center" VerticalAlignment="Center" Content="{Binding ProgressPercentage}" />
                    <wpfControls:CircularProgressBar HorizontalAlignment="Center"
                                                     VerticalAlignment="Center"
                                                     Percentage="{Binding ProgressPercentage}"
                                                     SegmentColor="#026873"
                                                     x:Name="InnerProgressBar"
                                                     StrokeThickness="15"/>
                </Grid>
            </Grid>            
        </DockPanel>                            
    </Grid>
</UserControl>
